<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dla Agaty ‚ú®</title>

<style>
:root{
  --bg1:#050505;
  --bg2:#0b0b0b;
  --gold:#d4af37;
  --gold2:#f2d36b;
  --card: rgba(255, 255, 255, 0.06);
  --text: rgba(255,255,255,0.92);
}
*{ box-sizing:border-box; }

body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden;
  font-family: "Segoe UI", system-ui, Arial, sans-serif;
  color: var(--text);
  background:
    radial-gradient(1200px 700px at 15% 10%, rgba(212,175,55,0.12), transparent 55%),
    radial-gradient(900px 600px at 85% 20%, rgba(242,211,107,0.10), transparent 50%),
    linear-gradient(135deg, var(--bg1), var(--bg2));
  position: relative;
}

/* Kr√≥tkie przyciemnienie t≈Ça */
#dim{
  position: fixed;
  inset: 0;
  opacity: 0;
  transition: opacity 220ms ease;
  pointer-events: none;
  z-index: 0;
  background: rgba(0,0,0,0.0);
}
#dim.on{
  opacity: 1;
  background: rgba(0,0,0,0.28);
}

.card{
  width: min(560px, 92vw);
  max-height: 90vh;
  overflow:auto;
  padding: 34px 28px;
  border-radius: 26px;
  background: linear-gradient(180deg, var(--card), rgba(255,255,255,0.04));
  border: 1px solid rgba(212,175,55,0.28);
  box-shadow: 0 20px 50px rgba(0,0,0,0.55);
  backdrop-filter: blur(12px);
  position: relative;
  z-index: 2;
}

/* p≈Çynne przej≈õcia scen */
.scene{
  transition: opacity 520ms ease, transform 520ms ease, filter 520ms ease;
  will-change: opacity, transform, filter;
}
.scene.out{
  opacity: 0;
  transform: translateY(-6px);
  filter: blur(1px);
  pointer-events: none;
}
.scene.in{
  opacity: 0;
  transform: translateY(10px);
  filter: blur(1px);
}
.scene.in.show{
  opacity: 1;
  transform: translateY(0);
  filter: blur(0);
}

h1{
  margin: 0 0 10px 0;
  font-weight: 550;
  font-size: 34px;
  color: var(--gold2);
}
.sub{
  font-size:18px;
  line-height:1.7;
  color: rgba(255,255,255,0.82);
}
h2{ margin-top:20px; font-weight:600; }

.buttons{
  margin-top: 26px;
  display:flex;
  justify-content:center;
  gap: 18px;
  flex-wrap: wrap;
}

/* przyciski */
.btn{
  font-size: 18px;
  padding: 12px 22px;
  border-radius: 999px;
  cursor: pointer;
  border: 1px solid rgba(212,175,55,0.45);
  transition: transform 220ms ease, box-shadow 220ms ease, filter 220ms ease, opacity 220ms ease;
  user-select:none;
  will-change: transform, box-shadow, filter, opacity;
}

.btnRow{
  display:flex;
  gap: 12px;
  flex-wrap: wrap;
  margin-top: 14px;
}
.btnWide{
  width: 100%;
  justify-content: center;
  display: inline-flex;
  align-items: center;
  gap: 10px;
}

#yes{
  background: linear-gradient(135deg, rgba(212,175,55,0.95), rgba(242,211,107,0.85));
  color: #0b0b0b;
  box-shadow: 0 10px 24px rgba(212,175,55,0.18);
  transform: scale(1);
}

/* puls TAK */
.pulse{
  animation: pulse 1.05s ease-in-out infinite;
  box-shadow:
    0 16px 34px rgba(212,175,55,0.25),
    0 0 22px rgba(212,175,55,0.22),
    0 0 44px rgba(242,211,107,0.16);
}
@keyframes pulse{
  0%   { transform: scale(var(--s)); filter: brightness(1); }
  50%  { transform: scale(calc(var(--s) + 0.045)); filter: brightness(1.06); }
  100% { transform: scale(var(--s)); filter: brightness(1); }
}

#no{
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.92);
  border-color: rgba(255,255,255,0.18);
  position: relative;
}

/* pƒôkniƒôcie NIE */
.crack{
  animation: crack 520ms ease forwards;
  transform-origin: center;
}
@keyframes crack{
  0%   { transform: translate(0,0) rotate(0) scale(1); opacity: 1; }
  35%  { transform: translate(-6px, 2px) rotate(-4deg) scale(1.02); }
  55%  { transform: translate(7px, -2px) rotate(6deg) scale(0.98); }
  100% { transform: translate(0, 30px) rotate(18deg) scale(0.65); opacity: 0; }
}

/* iskierki */
#sparksLayer{
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 1;
}
.spark{
  position: absolute;
  width: 5px;
  height: 5px;
  border-radius: 999px;
  background: rgba(212,175,55,0.95);
  box-shadow: 0 0 10px rgba(212,175,55,0.35);
  opacity: 0;
  animation: spark 520ms ease-out forwards;
}
@keyframes spark{
  0%   { opacity: 0; transform: translate(0,0) scale(0.9); }
  15%  { opacity: 1; }
  100% { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(0.7); }
}

/* serduszka */
#heartsLayer{
  position: fixed;
  inset: 0;
  pointer-events: none;
  display:none;
  z-index: 1;
}
.goldHeart{
  position: absolute;
  bottom: -40px;
  font-size: 18px;
  color: rgba(212,175,55,0.85);
  text-shadow: 0 0 14px rgba(212,175,55,0.22);
  animation: floatUp linear forwards;
}
@keyframes floatUp{
  0%   { transform: translateY(0) translateX(0); opacity:0; }
  10%  { opacity:0.9; }
  100% { transform: translateY(-110vh) translateX(var(--drift)); opacity:0; }
}

/* ‚úÖ LATAJƒÑCE NAPISY W TLE (AKT 1) */
#loveTextLayer{
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  overflow: hidden;
}
.loveText{
  position: absolute;
  left: -25vw;
  top: 10vh;
  padding: 10px 14px;
  border-radius: 999px;
  font-size: 18px;
  letter-spacing: 0.2px;

  color: rgba(242,211,107,0.55);
  border: 1px solid rgba(212,175,55,0.18);
  background: rgba(0,0,0,0.12);
  backdrop-filter: blur(6px);

  opacity: 0;
  filter: blur(0.6px);
  text-shadow: 0 0 16px rgba(212,175,55,0.10);

  animation: driftText linear forwards;
  will-change: transform, opacity;
}
@keyframes driftText{
  0%   { transform: translateX(-18vw) translateY(0); opacity: 0; }
  12%  { opacity: 0.9; }
  85%  { opacity: 0.75; }
  100% { transform: translateX(140vw) translateY(var(--dy)); opacity: 0; }
}
@media (max-width: 600px){
  .loveText{ font-size: 16px; padding: 9px 12px; }
}

/* AKT 2 ‚Äì zaproszenie tajemnicze */
#finalTitle{
  font-size:28px;
  color: var(--gold2);
  margin-top: 0;
}
.meta{ margin: 6px 0 14px; opacity:0.8; }

.mysteryBox{
  margin: 10px 0 16px;
  padding: 16px 16px;
  border-radius: 16px;
  background: rgba(212,175,55,0.06);
  border: 1px solid rgba(212,175,55,0.18);
  line-height: 1.75;
  color: rgba(255,255,255,0.86);
}
.mysteryBox strong{ color: rgba(242,211,107,0.92); }
.smallHint{
  margin-top: 12px;
  padding-top: 10px;
  border-top: 1px dashed rgba(242,211,107,0.18);
  opacity: 0.92;
}

#final img{
  width: 100%;
  max-height: 52vh;
  object-fit: contain;
  border-radius: 18px;
  border: 1px solid rgba(212,175,55,0.22);
  box-shadow: 0 18px 40px rgba(0,0,0,0.55);
}

/* SPOTIFY */
.spotifyWrap{ margin-top: 14px; }
.spotifyPrimaryBtn{
  width: 100%;
  display: inline-flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  padding: 12px 14px;
  border-radius: 999px;
  cursor: pointer;
  border: 1px solid rgba(212,175,55,0.45);
  background: linear-gradient(135deg, rgba(212,175,55,0.92), rgba(242,211,107,0.82));
  color: #0b0b0b;
  font-weight: 800;
  box-shadow: 0 10px 22px rgba(212,175,55,0.16);
  transition: transform 180ms ease, filter 180ms ease;
}
.spotifyPrimaryBtn:hover{ transform: translateY(-1px); filter: brightness(1.05); }

.spotifyPanel{
  margin-top: 12px;
  padding: 14px 14px;
  border-radius: 16px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(212,175,55,0.18);
  overflow: hidden;

  max-height: 0;
  opacity: 0;
  transform: translateY(-4px);
  transition: max-height 420ms ease, opacity 260ms ease, transform 260ms ease;
}
.spotifyPanel.open{
  max-height: 620px;
  opacity: 1;
  transform: translateY(0);
}
.spotifyLine{
  color: rgba(255,255,255,0.86);
  line-height: 1.6;
  margin-bottom: 10px;
}
.lyrics{
  margin: 0 0 12px 0;
  padding: 12px;
  border-radius: 14px;
  background: rgba(212,175,55,0.06);
  border: 1px solid rgba(212,175,55,0.18);
  color: rgba(255,255,255,0.86);
  line-height: 1.65;
  white-space: pre-line;
}
.spotifyGo{
  display:inline-flex;
  align-items:center;
  gap: 8px;
  padding: 10px 14px;
  border-radius: 999px;
  text-decoration: none;
  color: #0b0b0b;
  font-weight: 800;
  border: 1px solid rgba(212,175,55,0.45);
  background: linear-gradient(135deg, rgba(212,175,55,0.92), rgba(242,211,107,0.82));
  box-shadow: 0 10px 22px rgba(212,175,55,0.16);
  transition: transform 180ms ease, filter 180ms ease;
}
.spotifyGo:hover{ transform: translateY(-1px); filter: brightness(1.05); }

/* WYBORY DO SMS */
.pickBox{
  margin-top: 14px;
  padding: 14px;
  border-radius: 16px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(212,175,55,0.16);
}
.pickTitle{
  color: rgba(242,211,107,0.92);
  font-weight: 800;
  margin-bottom: 8px;
}
.picks{ display:flex; gap: 10px; flex-wrap: wrap; }
.chip{
  cursor: pointer;
  border-radius: 999px;
  padding: 9px 12px;
  border: 1px solid rgba(212,175,55,0.26);
  background: rgba(0,0,0,0.20);
  color: rgba(255,255,255,0.88);
  transition: transform 160ms ease, background 160ms ease, border-color 160ms ease;
  user-select:none;
}
.chip:hover{ transform: translateY(-1px); border-color: rgba(242,211,107,0.36); }
.chip.active{
  background: rgba(212,175,55,0.18);
  border-color: rgba(242,211,107,0.55);
  color: rgba(255,255,255,0.96);
}

/* AKT 3 ‚Äì uczuciowa wiadomo≈õƒá */
.final3Title{
  font-size: 26px;
  margin: 0 0 10px 0;
  color: rgba(242,211,107,0.96);
}
.final3Box{
  margin-top: 12px;
  padding: 16px 16px;
  border-radius: 16px;
  background: rgba(212,175,55,0.06);
  border: 1px solid rgba(212,175,55,0.18);
  line-height: 1.75;
  color: rgba(255,255,255,0.88);
}
.signature{
  margin-top: 12px;
  padding-top: 10px;
  border-top: 1px dashed rgba(242,211,107,0.18);
  color: rgba(255,255,255,0.86);
}

/* MODAL KR√ìWKA */
#cowModal{
  position: fixed;
  inset: 0;
  display:none;
  align-items: center;
  justify-content: center;
  z-index: 999;
}
#cowModal.on{ display:flex; }
.cowBackdrop{
  position:absolute;
  inset:0;
  background: rgba(0,0,0,0.62);
  backdrop-filter: blur(6px);
}
.cowCard{
  position: relative;
  width: min(520px, 92vw);
  border-radius: 22px;
  background: rgba(15,15,15,0.92);
  border: 1px solid rgba(212,175,55,0.28);
  box-shadow: 0 30px 80px rgba(0,0,0,0.7);
  padding: 14px;
  overflow:hidden;
  transform: translateY(10px);
  opacity: 0;
  animation: cowIn 260ms ease forwards;
}
@keyframes cowIn{
  to{ transform: translateY(0); opacity: 1; }
}
.cowTop{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 10px;
  padding: 6px 6px 10px;
}
.cowTop .t{
  color: rgba(242,211,107,0.95);
  font-weight: 900;
}
.cowClose{
  cursor:pointer;
  border: 1px solid rgba(212,175,55,0.30);
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.9);
  border-radius: 999px;
  padding: 8px 12px;
}
.cowImg{
  width: 100%;
  max-height: 64vh;
  object-fit: contain;
  border-radius: 18px;
  border: 1px solid rgba(212,175,55,0.18);
}

/* ‚úÖ KONTROLKA MUZYKI */
.musicCtrl{
  margin-top: 12px;
  display:flex;
  gap: 10px;
  align-items:center;
  flex-wrap: wrap;
}
.musicBtn{
  display:inline-flex;
  align-items:center;
  gap: 10px;
  border-radius: 999px;
  padding: 10px 14px;
  cursor:pointer;
  border: 1px solid rgba(212,175,55,0.28);
  background: rgba(255,255,255,0.05);
  color: rgba(255,255,255,0.92);
  transition: transform 180ms ease, filter 180ms ease, border-color 180ms ease;
}
.musicBtn:hover{ transform: translateY(-1px); border-color: rgba(242,211,107,0.40); }
.musicDot{
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: rgba(242,211,107,0.55);
  box-shadow: 0 0 14px rgba(212,175,55,0.25);
}
.musicDot.on{ background: rgba(242,211,107,0.95); }
.musicMsg{
  font-size: 13px;
  opacity: .78;
}
</style>
</head>

<body>

<!-- napisy w tle (akt 1) -->
<div id="loveTextLayer" aria-hidden="true"></div>

<div id="dim"></div>
<div id="heartsLayer"></div>
<div id="sparksLayer"></div>

<!-- audio -->
<audio id="bgm" preload="auto" loop>
  <source src="music.mp3" type="audio/mpeg">
</audio>

<!-- modal kr√≥wki -->
<div id="cowModal" aria-hidden="true">
  <div class="cowBackdrop"></div>
  <div class="cowCard" role="dialog" aria-modal="true" aria-label="Ukryta wiadomo≈õƒá">
    <div class="cowTop">
      <div class="t">üêÆ Tajna kr√≥wka d≈Çugow≈Çosa ‚ú®</div>
      <button class="cowClose" id="cowCloseBtn" type="button">Zamknij</button>
    </div>
    <img class="cowImg" src="krowka.jpg" alt="Kr√≥wka d≈Çugow≈Çosa">
  </div>
</div>

<div class="card">

  <!-- AKT 1 -->
  <div id="intro" class="scene">
    <h1 id="titleAgata">Dla Agaty ‚ú®</h1>

    <p class="sub">
      Twoje obawy by≈Çy s≈Çuszne. Mia≈Ça≈õ racjƒô‚Ä¶<br>
      Nie patrzƒô ju≈º na Ciebie tak jak kiedy≈õ.<br><br>

      Patrzƒô na Ciebie mocniej. Pewniej. Z wiƒôkszym uczuciem.<br>
      OdkƒÖd zapad≈Ça decyzja, ≈ºe to nie koniec ‚Äî w moich oczach jeste≈õ jeszcze bardziej ‚ÄûTy‚Äù.<br><br>

      Kocham Ciƒô.<br>
      I dlatego chcƒô Ciƒô zapytaƒá o jedno‚Ä¶
    </p>

    <h2>Czy <span style="color: rgba(242,211,107,0.95);">Agol</span> zostanie MojƒÖ WalentynkƒÖ? üíò</h2>

    <div class="buttons">
      <button id="yes" class="btn" type="button">TAK üíõ</button>
      <button id="no" class="btn" type="button">NIE üôà</button>
    </div>
  </div>

  <!-- AKT 2 -->
  <div id="final" class="scene in" style="display:none;">
    <h2 id="finalTitle">Wiedzia≈Çem‚Ä¶ üíï</h2>
    <div class="meta">14.02.2026</div>

    <div class="mysteryBox">
      <strong>Zaproszenie</strong> do prywatnej domowej sali kinowej pe≈Çnej magicznego klimatu‚Ä¶ ‚ú®<br><br>

      Tego dnia przewidujƒô czas na ma≈Çy podarunek üéÅ, romantyczny seans üé¨, posi≈Çek üçΩÔ∏è,
      wino üç∑ (nie pamiƒôtam czy lubisz, wiƒôc spokojnie mo≈ºemy to ustaliƒá),
      oraz Mszƒô za cudownego cz≈Çowieka ‚õ™üíõ

      <div class="smallHint">
        Czy mam wiƒôcej kart w zanadrzu? üòè<br>
        <strong>Nie mogƒô wiƒôcej zdradziƒá.</strong>
      </div>
    </div>

    <p class="sub">To jeden z tych moment√≥w, do kt√≥rych chcƒô wracaƒá‚Ä¶ üíû</p>

    <img src="photo.jpg" alt="Nasze zdjƒôcie">

    <!-- kontrolka muzyki -->
    <div class="musicCtrl">
      <button id="musicToggle" class="musicBtn" type="button">
        <span id="musicDot" class="musicDot"></span>
        <span id="musicLabel">Muzyka: OFF</span>
      </button>
      <div id="musicMsg" class="musicMsg"></div>
    </div>

    <!-- wybory do SMS -->
    <div class="pickBox">
      <div class="pickTitle">Ma≈Ça decyzja przed wys≈Çaniem SMS üòÑ‚ú®</div>

      <div style="margin-top:10px;">
        <div style="opacity:.86; margin-bottom:6px;">Kto decyduje o jedzeniu? üçΩÔ∏è</div>
        <div class="picks" id="foodPicks">
          <div class="chip active" data-value="SEBA">SEBA</div>
          <div class="chip" data-value="AGA">AGA</div>
          <div class="chip" data-value="MY">MY</div>
        </div>
      </div>

      <div style="margin-top:12px;">
        <div style="opacity:.86; margin-bottom:6px;">Kto decyduje o filmie? üé¨</div>
        <div class="picks" id="moviePicks">
          <div class="chip" data-value="SEBA">SEBA</div>
          <div class="chip active" data-value="AGA">AGA</div>
          <div class="chip" data-value="MY">MY</div>
        </div>
      </div>

      <div style="margin-top:12px;">
        <div style="opacity:.86; margin-bottom:6px;">Winko? üç∑</div>
        <div class="picks" id="winePicks">
          <div class="chip" data-value="TAK">TAK</div>
          <div class="chip" data-value="NIE">NIE</div>
          <div class="chip active" data-value="USTALIMY">USTALIMY</div>
        </div>
      </div>
    </div>

    <div class="btnRow">
      <button id="smsBtn" class="btn btnWide" type="button" style="background: rgba(212,175,55,0.16); color: rgba(255,255,255,0.92); border-color: rgba(212,175,55,0.35);">
        üì© Wy≈õlij mi SMS (zgoda üíõ)
      </button>

      <button id="nextActBtn" class="btn btnWide" type="button" style="background: rgba(255,255,255,0.06); color: rgba(255,255,255,0.92); border-color: rgba(212,175,55,0.28);">
        Dalej ‚ú®
      </button>
    </div>

    <!-- Spotify (podmienisz p√≥≈∫niej link) -->
    <div class="spotifyWrap">
      <button id="spotifyToggle" class="spotifyPrimaryBtn" type="button" aria-expanded="false" aria-controls="spotifyPanel">
        üéß Otw√≥rz na Spotify
      </button>

      <div id="spotifyPanel" class="spotifyPanel" aria-hidden="true">
        <div class="spotifyLine">Ten kawa≈Çek ma lecieƒá w tle‚Ä¶ dla nas üíõ</div>
        <div class="lyrics">Podmienimy p√≥≈∫niej tekst i link ‚ú®</div>
        <a class="spotifyGo" id="spotifyLink" href="#" target="_blank" rel="noopener noreferrer">
          Przejd≈∫ do Spotify ‚ú®
        </a>
      </div>
    </div>
  </div>

  <!-- AKT 3 -->
  <div id="final3" class="scene in" style="display:none;">
    <h2 class="final3Title">Zanim siƒô spotkamy‚Ä¶ üíõ</h2>

    <div class="final3Box">
      Agata‚Ä¶<br><br>
      Nie chcƒô ju≈º wracaƒá do wersji ≈õwiata, w kt√≥rej jeste≈õmy ‚Äúprawie‚Äù.<br>
      Chcƒô tej, w kt√≥rej jeste≈õmy <strong>naprawdƒô</strong> ‚Äî spokojnie, pewnie i ciep≈Ço.<br><br>

      Je≈õli zgodzisz siƒô zostaƒá mojƒÖ WalentynkƒÖ, to obiecujƒô jedno:
      bƒôdƒô robi≈Ç wszystko, ≈ºeby≈õ czu≈Ça siƒô przy mnie bezpiecznie, kochana i wa≈ºna. üñ§‚ú®<br><br>

      I ≈ºe to, co w ko≈Ñcu zobaczysz‚Ä¶ bƒôdzie warte czekania.
      <div class="signature">
        ‚Äî Tw√≥j Seba üíõ
      </div>
    </div>

    <!-- kontrolka muzyki te≈º w akcie 3 -->
    <div class="musicCtrl">
      <button id="musicToggle2" class="musicBtn" type="button">
        <span id="musicDot2" class="musicDot"></span>
        <span id="musicLabel2">Muzyka: OFF</span>
      </button>
      <div class="musicMsg">Je≈õli nie gra ‚Äî kliknij, ≈ºeby w≈ÇƒÖczyƒá.</div>
    </div>

    <div class="btnRow" style="margin-top:14px;">
      <button id="smsBtn2" class="btn btnWide" type="button" style="background: linear-gradient(135deg, rgba(212,175,55,0.92), rgba(242,211,107,0.82)); color:#0b0b0b; font-weight:800;">
        üì© Wy≈õlij SMS (zgoda) üíõ
      </button>

      <button id="backToPlan" class="btn btnWide" type="button" style="background: rgba(255,255,255,0.06); color: rgba(255,255,255,0.92); border-color: rgba(212,175,55,0.28);">
        Wr√≥ƒá ‚Ü©Ô∏è
      </button>
    </div>
  </div>

</div>

<script>
/* =========================
   USTAWIENIA
========================= */
const SMS_NUMBER = "731132304";
const SPOTIFY_URL = "#"; // podmienimy p√≥≈∫niej

/* =========================
   ELEMENTY
========================= */
const yesBtn = document.getElementById("yes");
const noBtn = document.getElementById("no");

const intro = document.getElementById("intro");
const final = document.getElementById("final");
const final3 = document.getElementById("final3");

const heartsLayer = document.getElementById("heartsLayer");
const sparksLayer = document.getElementById("sparksLayer");
const dim = document.getElementById("dim");

const spotifyToggle = document.getElementById("spotifyToggle");
const spotifyPanel = document.getElementById("spotifyPanel");
const spotifyLink = document.getElementById("spotifyLink");

const nextActBtn = document.getElementById("nextActBtn");
const backToPlan = document.getElementById("backToPlan");

const smsBtn = document.getElementById("smsBtn");
const smsBtn2 = document.getElementById("smsBtn2");

const loveLayer = document.getElementById("loveTextLayer");
const titleAgata = document.getElementById("titleAgata");

const cowModal = document.getElementById("cowModal");
const cowCloseBtn = document.getElementById("cowCloseBtn");

/* Muzyka */
const bgm = document.getElementById("bgm");
const musicToggle = document.getElementById("musicToggle");
const musicDot = document.getElementById("musicDot");
const musicLabel = document.getElementById("musicLabel");
const musicMsg = document.getElementById("musicMsg");

const musicToggle2 = document.getElementById("musicToggle2");
const musicDot2 = document.getElementById("musicDot2");
const musicLabel2 = document.getElementById("musicLabel2");

spotifyLink.href = SPOTIFY_URL;

/* =========================
   WYBORY DO SMS
========================= */
function setupChips(groupEl){
  const chips = [...groupEl.querySelectorAll(".chip")];
  chips.forEach(ch => {
    ch.addEventListener("click", () => {
      chips.forEach(c => c.classList.remove("active"));
      ch.classList.add("active");
    });
  });
  return () => {
    const a = groupEl.querySelector(".chip.active");
    return a ? a.dataset.value : "";
  };
}
const getFood = setupChips(document.getElementById("foodPicks"));
const getMovie = setupChips(document.getElementById("moviePicks"));
const getWine = setupChips(document.getElementById("winePicks"));

function buildSMSText(){
  const food = getFood();
  const movie = getMovie();
  const wine = getWine();

  return [
    "TAK üíõ",
    "Zgadzam siƒô byƒá TwojƒÖ WalentynkƒÖ.",
    "",
    `Jedzenie decyduje: ${food}`,
    `Film decyduje: ${movie}`,
    `Winko: ${wine}`,
  ].join("\n");
}

function openSMS(){
  const text = buildSMSText();
  const msg = encodeURIComponent(text);
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const link = isIOS
    ? `sms:${SMS_NUMBER}&body=${msg}`
    : `sms:${SMS_NUMBER}?body=${msg}`;
  window.location.href = link;
}

/* =========================
   MUZYKA: ON/OFF + FADE
========================= */
let musicOn = false;
let fadeTimer = null;

function setMusicUI(on){
  musicOn = on;
  if(musicDot) musicDot.classList.toggle("on", on);
  if(musicLabel) musicLabel.textContent = on ? "Muzyka: ON" : "Muzyka: OFF";
  if(musicDot2) musicDot2.classList.toggle("on", on);
  if(musicLabel2) musicLabel2.textContent = on ? "Muzyka: ON" : "Muzyka: OFF";
}

function fadeTo(target, ms=700){
  if(fadeTimer) cancelAnimationFrame(fadeTimer);
  const start = bgm.volume;
  const t0 = performance.now();

  function step(now){
    const p = Math.min(1, (now - t0) / ms);
    bgm.volume = start + (target - start) * p;
    if(p < 1) fadeTimer = requestAnimationFrame(step);
  }
  fadeTimer = requestAnimationFrame(step);
}

async function startMusic(){
  // startujemy bardzo cicho i wchodzimy fade-in
  bgm.volume = 0.02;
  try{
    await bgm.play();
    setMusicUI(true);
    musicMsg && (musicMsg.textContent = "");
    fadeTo(0.18, 900); // docelowa g≈Ço≈õno≈õƒá (mo≈ºesz zmieniƒá np. 0.12 / 0.22)
  }catch(err){
    setMusicUI(false);
    if(musicMsg){
      musicMsg.textContent = "Nie uda≈Ço siƒô odtworzyƒá. Je≈õli plik by≈Ç m4a a nazwany mp3, trzeba go przekonwertowaƒá do MP3.";
    }
  }
}

function stopMusic(){
  // fade-out i pauza
  fadeTo(0.0, 550);
  setTimeout(() => {
    bgm.pause();
  }, 560);
  setMusicUI(false);
}

async function toggleMusic(){
  if(!musicOn){
    await startMusic();
  }else{
    stopMusic();
  }
}

musicToggle.addEventListener("click", toggleMusic);
musicToggle2.addEventListener("click", toggleMusic);

/* je≈õli audio zg≈Çosi b≈ÇƒÖd */
bgm.addEventListener("error", () => {
  setMusicUI(false);
  if(musicMsg){
    musicMsg.textContent = "Plik audio nie mo≈ºe zostaƒá odtworzony. Upewnij siƒô, ≈ºe to prawdziwy MP3 (nie m4a pod nazwƒÖ mp3).";
  }
});

/* =========================
   TAK/NIE ‚Äì zostaje jak by≈Ço
========================= */
let yesScale = 1;
const maxScale = 1.38;
const pulseStartAt = 1.18;
let cracked = false;

function applyYesScale(){
  yesBtn.style.setProperty("--s", yesScale.toFixed(3));
  if(!yesBtn.classList.contains("pulse")){
    yesBtn.style.transform = `scale(${yesScale})`;
  }
}
applyYesScale();

function spawnSparksAt(x, y){
  const count = 9;
  for(let i=0;i<count;i++){
    const s = document.createElement("div");
    s.className = "spark";
    s.style.left = x + "px";
    s.style.top  = y + "px";
    s.style.setProperty("--dx", (Math.random()*80 - 40).toFixed(0) + "px");
    s.style.setProperty("--dy", (-20 - Math.random()*70).toFixed(0) + "px");
    s.style.animationDelay = (Math.random()*70).toFixed(0) + "ms";
    const size = (3 + Math.random()*3).toFixed(0) + "px";
    s.style.width = size;
    s.style.height = size;

    sparksLayer.appendChild(s);
    s.addEventListener("animationend", () => s.remove(), { once:true });
  }
}

function crackNo(){
  if(cracked) return;
  cracked = true;

  const r = noBtn.getBoundingClientRect();
  spawnSparksAt(r.left + r.width/2, r.top + r.height/2);

  noBtn.classList.add("crack");
  noBtn.style.pointerEvents = "none";
  noBtn.addEventListener("animationend", () => {
    noBtn.style.display = "none";
  }, { once:true });
}

function maybeEnablePulse(){
  if(yesScale >= pulseStartAt && !yesBtn.classList.contains("pulse")){
    yesBtn.classList.add("pulse");
    crackNo();
  }
}

function dodgeNo(){
  if(noBtn.style.display !== "none"){
    const x = Math.random() * 220 - 110;
    const y = Math.random() * 120 - 60;
    noBtn.style.transform = `translate(${x}px, ${y}px)`;
  }

  yesScale = Math.min(maxScale, yesScale + 0.055);
  applyYesScale();
  maybeEnablePulse();
}

/* NIE ucieka */
noBtn.addEventListener("mouseover", dodgeNo);
noBtn.addEventListener("touchstart", (e) => {
  e.preventDefault();
  dodgeNo();
}, {passive:false });

/* serduszka po TAK */
function spawnHeart(){
  const h = document.createElement("div");
  h.className = "goldHeart";
  h.textContent = "üíõ";
  h.style.left = Math.random()*100 + "vw";
  h.style.setProperty("--drift", (Math.random()*80 - 40).toFixed(0) + "px");
  h.style.animationDuration = (5.2 + Math.random()*4.2).toFixed(2) + "s";
  h.style.fontSize = (14 + Math.random()*10).toFixed(0) + "px";
  h.style.opacity = (0.55 + Math.random()*0.35).toFixed(2);
  heartsLayer.appendChild(h);
  h.addEventListener("animationend", ()=>h.remove(), { once:true });
}
function startHearts(){
  heartsLayer.style.display = "block";
  for(let i=0;i<10;i++) setTimeout(spawnHeart, i*120);
  setInterval(spawnHeart, 280);
}

/* =========================
   PRZEJ≈öCIA
========================= */
function transition(fromEl, toEl){
  toEl.classList.remove("out");
  toEl.classList.add("in");
  toEl.classList.remove("show");

  dim.classList.add("on");
  setTimeout(() => dim.classList.remove("on"), 260);

  fromEl.classList.add("out");
  fromEl.classList.remove("show");

  setTimeout(() => {
    fromEl.style.display = "none";
    fromEl.classList.remove("out");

    toEl.style.display = "block";
    requestAnimationFrame(() => toEl.classList.add("show"));
  }, 520);
}

/* AKT 1 -> AKT 2 */
function goToFinalSmooth(){
  stopLoveTexts();

  final.classList.remove("out");
  final.classList.add("in");
  final.classList.remove("show");

  dim.classList.add("on");
  setTimeout(() => dim.classList.remove("on"), 260);

  intro.classList.add("out");

  setTimeout(async () => {
    intro.style.display = "none";
    intro.classList.remove("out");

    final.style.display = "block";
    requestAnimationFrame(() => final.classList.add("show"));
    setTimeout(startHearts, 250);

    // ‚úÖ muzyka startuje po klikniƒôciu TAK (dozwolone przez przeglƒÖdarki)
    await startMusic();
  }, 520);
}
yesBtn.addEventListener("click", goToFinalSmooth);

/* AKT 2 -> AKT 3 */
nextActBtn.addEventListener("click", () => transition(final, final3));
/* AKT 3 -> AKT 2 */
backToPlan.addEventListener("click", () => transition(final3, final));

/* Spotify panel */
spotifyToggle.addEventListener("click", () => {
  const open = spotifyPanel.classList.toggle("open");
  spotifyToggle.setAttribute("aria-expanded", String(open));
  spotifyPanel.setAttribute("aria-hidden", String(!open));
});

/* SMS */
smsBtn.addEventListener("click", openSMS);
smsBtn2.addEventListener("click", openSMS);

/* =========================
   LATAJƒÑCE NAPISY (AKT 1)
========================= */
const LOVE_PHRASES = [
  "kocham ciƒô üíõ",
  "m√≥j skarb ‚ú®",
  "z TobƒÖ zawsze üñ§",
  "jeste≈õ moim domem üè°",
  "tylko ty üåô",
  "najpiƒôkniejsza ü´∂",
  "Agol üíõ",
  "na zawsze i jeszcze dalej ‚ú®"
];

let loveTimer = null;
function spawnLoveText(){
  if(intro.style.display === "none") return;

  const t = document.createElement("div");
  t.className = "loveText";
  t.textContent = LOVE_PHRASES[Math.floor(Math.random()*LOVE_PHRASES.length)];

  const top = Math.random()*78 + 8;
  t.style.top = top + "vh";
  t.style.setProperty("--dy", (Math.random()*80 - 40).toFixed(0) + "px");

  const dur = 12 + Math.random()*10;
  t.style.animationDuration = dur.toFixed(2) + "s";

  const scale = 0.92 + Math.random()*0.22;
  t.style.transform = `scale(${scale.toFixed(2)})`;

  loveLayer.appendChild(t);
  t.addEventListener("animationend", () => t.remove(), { once:true });
}

function startLoveTexts(){
  if(loveTimer) return;
  for(let i=0;i<4;i++) setTimeout(spawnLoveText, i*650);
  loveTimer = setInterval(spawnLoveText, 950);
}
function stopLoveTexts(){
  if(!loveTimer) return;
  clearInterval(loveTimer);
  loveTimer = null;
  setTimeout(() => { loveLayer.innerHTML = ""; }, 400);
}
startLoveTexts();

/* =========================
   EASTER EGG: 4 klikniƒôcia -> kr√≥wka
========================= */
let titleClicks = 0;
let titleClickTimer = null;

function openCow(){
  cowModal.classList.add("on");
  cowModal.setAttribute("aria-hidden", "false");
}
function closeCow(){
  cowModal.classList.remove("on");
  cowModal.setAttribute("aria-hidden", "true");
}

titleAgata.addEventListener("click", () => {
  titleClicks += 1;

  if(titleClickTimer) clearTimeout(titleClickTimer);
  titleClickTimer = setTimeout(() => { titleClicks = 0; }, 900);

  if(titleClicks >= 4){
    titleClicks = 0;
    openCow();
  }
});

cowCloseBtn.addEventListener("click", closeCow);
cowModal.querySelector(".cowBackdrop").addEventListener("click", closeCow);
document.addEventListener("keydown", (e) => {
  if(e.key === "Escape") closeCow();
});

/* UI startowe muzyki */
setMusicUI(false);
</script>

</body>
</html>
