<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dla Agaty âœ¨</title>

<style>
:root{
  --bg1:#050505;
  --bg2:#0b0b0b;
  --gold:#d4af37;
  --gold2:#f2d36b;
  --card: rgba(255, 255, 255, 0.06);
  --text: rgba(255,255,255,0.92);
}
*{ box-sizing:border-box; }

body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden;
  font-family: "Segoe UI", system-ui, Arial, sans-serif;
  color: var(--text);
  background:
    radial-gradient(1200px 700px at 15% 10%, rgba(212,175,55,0.12), transparent 55%),
    radial-gradient(900px 600px at 85% 20%, rgba(242,211,107,0.10), transparent 50%),
    linear-gradient(135deg, var(--bg1), var(--bg2));
  position: relative;
}

/* KrÃ³tkie przyciemnienie tÅ‚a */
#dim{
  position: fixed;
  inset: 0;
  opacity: 0;
  transition: opacity 220ms ease;
  pointer-events: none;
  z-index: 0;
  background: rgba(0,0,0,0.0);
}
#dim.on{
  opacity: 1;
  background: rgba(0,0,0,0.28);
}

.card{
  width: min(560px, 92vw);
  max-height: 90vh;
  overflow:auto;
  padding: 34px 28px;
  border-radius: 26px;
  background: linear-gradient(180deg, var(--card), rgba(255,255,255,0.04));
  border: 1px solid rgba(212,175,55,0.28);
  box-shadow: 0 20px 50px rgba(0,0,0,0.55);
  backdrop-filter: blur(12px);
  position: relative;
  z-index: 2;
}

/* pÅ‚ynne przejÅ›cia scen */
.scene{
  transition: opacity 520ms ease, transform 520ms ease, filter 520ms ease;
  will-change: opacity, transform, filter;
}
.scene.out{
  opacity: 0;
  transform: translateY(-6px);
  filter: blur(1px);
  pointer-events: none;
}
.scene.in{
  opacity: 0;
  transform: translateY(10px);
  filter: blur(1px);
}
.scene.in.show{
  opacity: 1;
  transform: translateY(0);
  filter: blur(0);
}

h1{
  margin: 0 0 10px 0;
  font-weight: 550;
  font-size: 34px;
  color: var(--gold2);
}
.sub{
  font-size:18px;
  line-height:1.7;
  color: rgba(255,255,255,0.82);
}
h2{ margin-top:20px; font-weight:600; }

.buttons{
  margin-top: 26px;
  display:flex;
  justify-content:center;
  gap: 18px;
  flex-wrap: wrap;
}

/* przyciski */
.btn{
  font-size: 18px;
  padding: 12px 22px;
  border-radius: 999px;
  cursor: pointer;
  border: 1px solid rgba(212,175,55,0.45);
  transition: transform 220ms ease, box-shadow 220ms ease, filter 220ms ease, opacity 220ms ease;
  user-select:none;
  will-change: transform, box-shadow, filter, opacity;
}

.btnRow{
  display:flex;
  gap: 12px;
  flex-wrap: wrap;
  margin-top: 14px;
}
.btnWide{
  width: 100%;
  justify-content: center;
  display: inline-flex;
  align-items: center;
  gap: 10px;
}

#yes{
  background: linear-gradient(135deg, rgba(212,175,55,0.95), rgba(242,211,107,0.85));
  color: #0b0b0b;
  box-shadow: 0 10px 24px rgba(212,175,55,0.18);
  transform: scale(1);
}

/* puls TAK */
.pulse{
  animation: pulse 1.05s ease-in-out infinite;
  box-shadow:
    0 16px 34px rgba(212,175,55,0.25),
    0 0 22px rgba(212,175,55,0.22),
    0 0 44px rgba(242,211,107,0.16);
}
@keyframes pulse{
  0%   { transform: scale(var(--s)); filter: brightness(1); }
  50%  { transform: scale(calc(var(--s) + 0.045)); filter: brightness(1.06); }
  100% { transform: scale(var(--s)); filter: brightness(1); }
}

#no{
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.92);
  border-color: rgba(255,255,255,0.18);
  position: relative;
}

/* pÄ™kniÄ™cie NIE */
.crack{
  animation: crack 520ms ease forwards;
  transform-origin: center;
}
@keyframes crack{
  0%   { transform: translate(0,0) rotate(0) scale(1); opacity: 1; }
  35%  { transform: translate(-6px, 2px) rotate(-4deg) scale(1.02); }
  55%  { transform: translate(7px, -2px) rotate(6deg) scale(0.98); }
  100% { transform: translate(0, 30px) rotate(18deg) scale(0.65); opacity: 0; }
}

/* iskierki */
#sparksLayer{
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 1;
}
.spark{
  position: absolute;
  width: 5px;
  height: 5px;
  border-radius: 999px;
  background: rgba(212,175,55,0.95);
  box-shadow: 0 0 10px rgba(212,175,55,0.35);
  opacity: 0;
  animation: spark 520ms ease-out forwards;
}
@keyframes spark{
  0%   { opacity: 0; transform: translate(0,0) scale(0.9); }
  15%  { opacity: 1; }
  100% { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(0.7); }
}

/* serduszka */
#heartsLayer{
  position: fixed;
  inset: 0;
  pointer-events: none;
  display:none;
  z-index: 1;
}
.goldHeart{
  position: absolute;
  bottom: -40px;
  font-size: 18px;
  color: rgba(212,175,55,0.85);
  text-shadow: 0 0 14px rgba(212,175,55,0.22);
  animation: floatUp linear forwards;
}
@keyframes floatUp{
  0%   { transform: translateY(0) translateX(0); opacity:0; }
  10%  { opacity:0.9; }
  100% { transform: translateY(-110vh) translateX(var(--drift)); opacity:0; }
}

/* âœ… LATAJÄ„CE NAPISY W TLE (AKT 1) */
#loveTextLayer{
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  overflow: hidden;
}
.loveText{
  position: absolute;
  left: -25vw;
  top: 10vh;
  padding: 10px 14px;
  border-radius: 999px;
  font-size: 18px;
  letter-spacing: 0.2px;

  color: rgba(242,211,107,0.55);
  border: 1px solid rgba(212,175,55,0.18);
  background: rgba(0,0,0,0.12);
  backdrop-filter: blur(6px);

  opacity: 0;
  filter: blur(0.6px);
  text-shadow: 0 0 16px rgba(212,175,55,0.10);

  animation: driftText linear forwards;
  will-change: transform, opacity;
}
@keyframes driftText{
  0%   { transform: translateX(-18vw) translateY(0); opacity: 0; }
  12%  { opacity: 0.9; }
  85%  { opacity: 0.75; }
  100% { transform: translateX(140vw) translateY(var(--dy)); opacity: 0; }
}
@media (max-width: 600px){
  .loveText{ font-size: 16px; padding: 9px 12px; }
}

/* AKT 2 */
#finalTitle{
  font-size:28px;
  color: var(--gold2);
  margin-top: 0;
}
.meta{ margin: 6px 0 14px; opacity:0.8; }

.mysteryBox{
  margin: 10px 0 16px;
  padding: 16px 16px;
  border-radius: 16px;
  background: rgba(212,175,55,0.06);
  border: 1px solid rgba(212,175,55,0.18);
  line-height: 1.75;
  color: rgba(255,255,255,0.86);
}
.mysteryBox strong{
  color: rgba(242,211,107,0.92);
}
.smallHint{
  margin-top: 12px;
  padding-top: 10px;
  border-top: 1px dashed rgba(242,211,107,0.18);
  opacity: 0.92;
}

/* ZdjÄ™cie */
#final img{
  width: 100%;
  max-height: 52vh;
  object-fit: contain;
  border-radius: 18px;
  border: 1px solid rgba(212,175,55,0.22);
  box-shadow: 0 18px 40px rgba(0,0,0,0.55);
}

/* âœ… MUZYKA â€“ kontrolka */
.musicCtrl{
  margin-top: 12px;
  display:flex;
  gap: 10px;
  align-items:center;
  flex-wrap: wrap;
}
.musicBtn{
  display:inline-flex;
  align-items:center;
  gap: 10px;
  border-radius: 999px;
  padding: 10px 14px;
  cursor:pointer;
  border: 1px solid rgba(212,175,55,0.28);
  background: rgba(255,255,255,0.05);
  color: rgba(255,255,255,0.92);
  transition: transform 180ms ease, filter 180ms ease, border-color 180ms ease;
}
.musicBtn:hover{ transform: translateY(-1px); border-color: rgba(242,211,107,0.40); }
.musicDot{
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: rgba(242,211,107,0.55);
  box-shadow: 0 0 14px rgba(212,175,55,0.25);
}
.musicDot.on{ background: rgba(242,211,107,0.95); }
.musicMini{
  font-size: 13px;
  opacity: .80;
}

/* âœ… WYBORY DO SMS */
.pickBox{
  margin-top: 14px;
  padding: 14px;
  border-radius: 16px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(212,175,55,0.16);
}
.pickTitle{
  color: rgba(242,211,107,0.92);
  font-weight: 800;
  margin-bottom: 8px;
}
.picks{
  display:flex;
  gap: 10px;
  flex-wrap: wrap;
}
.chip{
  cursor: pointer;
  border-radius: 999px;
  padding: 9px 12px;
  border: 1px solid rgba(212,175,55,0.26);
  background: rgba(0,0,0,0.20);
  color: rgba(255,255,255,0.88);
  transition: transform 160ms ease, background 160ms ease, border-color 160ms ease;
  user-select:none;
}
.chip:hover{ transform: translateY(-1px); border-color: rgba(242,211,107,0.36); }
.chip.active{
  background: rgba(212,175,55,0.18);
  border-color: rgba(242,211,107,0.55);
  color: rgba(255,255,255,0.96);
}

/* AKT 3 */
.final3Title{
  font-size: 26px;
  margin: 0 0 10px 0;
  color: rgba(242,211,107,0.96);
}
.final3Box{
  margin-top: 12px;
  padding: 16px 16px;
  border-radius: 16px;
  background: rgba(212,175,55,0.06);
  border: 1px solid rgba(212,175,55,0.18);
  line-height: 1.75;
  color: rgba(255,255,255,0.88);
}
.signature{
  margin-top: 12px;
  padding-top: 10px;
  border-top: 1px dashed rgba(242,211,107,0.18);
  color: rgba(255,255,255,0.86);
}

/* âœ… MODAL KRÃ“WKA */
#cowModal{
  position: fixed;
  inset: 0;
  display:none;
  align-items: center;
  justify-content: center;
  z-index: 999;
}
#cowModal.on{ display:flex; }
.cowBackdrop{
  position:absolute;
  inset:0;
  background: rgba(0,0,0,0.62);
  backdrop-filter: blur(6px);
}
.cowCard{
  position: relative;
  width: min(520px, 92vw);
  border-radius: 22px;
  background: rgba(15,15,15,0.92);
  border: 1px solid rgba(212,175,55,0.28);
  box-shadow: 0 30px 80px rgba(0,0,0,0.7);
  padding: 14px;
  overflow:hidden;
  transform: translateY(10px);
  opacity: 0;
  animation: cowIn 260ms ease forwards;
}
@keyframes cowIn{ to{ transform: translateY(0); opacity: 1; } }
.cowTop{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 10px;
  padding: 6px 6px 10px;
}
.cowTop .t{
  color: rgba(242,211,107,0.95);
  font-weight: 900;
}
.cowClose{
  cursor:pointer;
  border: 1px solid rgba(212,175,55,0.30);
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.9);
  border-radius: 999px;
  padding: 8px 12px;
}
.cowImg{
  width: 100%;
  max-height: 64vh;
  object-fit: contain;
  border-radius: 18px;
  border: 1px solid rgba(212,175,55,0.18);
}
</style>
</head>

<body>

<div id="loveTextLayer" aria-hidden="true"></div>
<div id="dim"></div>
<div id="heartsLayer"></div>
<div id="sparksLayer"></div>

<!-- âœ… MUZYKA -->
<audio id="bgm" preload="auto" loop playsinline>
  <source src="music.mp3" type="audio/mpeg">
</audio>

<!-- âœ… Modal krÃ³wki -->
<div id="cowModal" aria-hidden="true">
  <div class="cowBackdrop"></div>
  <div class="cowCard" role="dialog" aria-modal="true" aria-label="Ukryta wiadomoÅ›Ä‡">
    <div class="cowTop">
      <div class="t">ğŸ® Tajna krÃ³wka dÅ‚ugowÅ‚osa âœ¨</div>
      <button class="cowClose" id="cowCloseBtn" type="button">Zamknij</button>
    </div>
    <img class="cowImg" src="krowka.jpg" alt="KrÃ³wka dÅ‚ugowÅ‚osa">
  </div>
</div>

<div class="card">

  <!-- AKT 1 -->
  <div id="intro" class="scene">
    <h1 id="titleAgata">Dla Agaty âœ¨</h1>

    <!-- âœ… muzyka w Akcie 1 -->
    <div class="musicCtrl">
      <button id="musicToggle0" class="musicBtn" type="button">
        <span id="musicDot0" class="musicDot"></span>
        <span id="musicLabel0">Muzyka: OFF</span>
      </button>
      <div class="musicMini" id="musicMini0">Dotknij/kliknij ekran, aby wÅ‚Ä…czyÄ‡ muzykÄ™ ğŸµ</div>
    </div>

    <p class="sub" style="margin-top:14px;">
      Twoje obawy byÅ‚y sÅ‚uszne. MiaÅ‚aÅ› racjÄ™â€¦<br>
      Nie patrzÄ™ juÅ¼ na Ciebie tak jak kiedyÅ›.<br><br>

      PatrzÄ™ na Ciebie mocniej. Pewniej. Z wiÄ™kszym uczuciem.<br>
      OdkÄ…d zapadÅ‚a decyzja, Å¼e to nie koniec â€” w moich oczach jesteÅ› jeszcze bardziej â€Tyâ€.<br><br>

      Kocham CiÄ™.<br>
      I dlatego chcÄ™ CiÄ™ zapytaÄ‡ o jednoâ€¦
    </p>

    <h2>Czy <span style="color: rgba(242,211,107,0.95);">Agol</span> zostanie MojÄ… WalentynkÄ…? ğŸ’˜</h2>

    <div class="buttons">
      <button id="yes" class="btn" type="button">TAK ğŸ’›</button>
      <button id="no" class="btn" type="button">NIE ğŸ™ˆ</button>
    </div>
  </div>

  <!-- AKT 2 -->
  <div id="final" class="scene in" style="display:none;">
    <h2 id="finalTitle">WiedziaÅ‚emâ€¦ ğŸ’•</h2>
    <div class="meta">14.02.2026</div>

    <div class="mysteryBox">
      <strong>Zaproszenie</strong> do prywatnej domowej sali kinowej peÅ‚nej magicznego klimatuâ€¦ âœ¨<br><br>

      Tego dnia przewidujÄ™ czas na maÅ‚y podarunek ğŸ, romantyczny seans ğŸ¬, posiÅ‚ek ğŸ½ï¸,
      wino ğŸ· (nie pamiÄ™tam czy lubisz, wiÄ™c spokojnie moÅ¼emy to ustaliÄ‡),
      oraz MszÄ™ za cudownego czÅ‚owieka â›ªğŸ’›

      <div class="smallHint">
        Czy mam wiÄ™cej kart w zanadrzu? ğŸ˜<br>
        <strong>Nie mogÄ™ wiÄ™cej zdradziÄ‡.</strong>
      </div>
    </div>

    <p class="sub">To jeden z tych momentÃ³w, do ktÃ³rych chcÄ™ wracaÄ‡â€¦ ğŸ’</p>

    <img src="photo.jpg" alt="Nasze zdjÄ™cie">

    <!-- âœ… muzyka -->
    <div class="musicCtrl">
      <button id="musicToggle" class="musicBtn" type="button">
        <span id="musicDot" class="musicDot"></span>
        <span id="musicLabel">Muzyka: OFF</span>
      </button>
      <div class="musicMini" id="musicMini">JeÅ›li nie gra â€” kliknij, Å¼eby wÅ‚Ä…czyÄ‡.</div>
    </div>

    <!-- âœ… wybory do SMS -->
    <div class="pickBox">
      <div class="pickTitle">MaÅ‚a decyzja przed wysÅ‚aniem SMS ğŸ˜„âœ¨</div>

      <div style="margin-top:10px;">
        <div style="opacity:.86; margin-bottom:6px;">Kto decyduje o jedzeniu? ğŸ½ï¸</div>
        <div class="picks" id="foodPicks">
          <div class="chip active" data-value="SEBA">SEBA</div>
          <div class="chip" data-value="AGA">AGA</div>
          <div class="chip" data-value="MY">MY</div>
        </div>
      </div>

      <div style="margin-top:12px;">
        <div style="opacity:.86; margin-bottom:6px;">Kto decyduje o filmie? ğŸ¬</div>
        <div class="picks" id="moviePicks">
          <div class="chip" data-value="SEBA">SEBA</div>
          <div class="chip active" data-value="AGA">AGA</div>
          <div class="chip" data-value="MY">MY</div>
        </div>
      </div>

      <div style="margin-top:12px;">
        <div style="opacity:.86; margin-bottom:6px;">Winko? ğŸ·</div>
        <div class="picks" id="winePicks">
          <div class="chip" data-value="TAK">TAK</div>
          <div class="chip" data-value="NIE">NIE</div>
          <div class="chip active" data-value="USTALIMY">USTALIMY</div>
        </div>
      </div>
    </div>

    <div class="btnRow">
      <button id="smsBtn" class="btn btnWide" type="button" style="background: rgba(212,175,55,0.16); color: rgba(255,255,255,0.92); border-color: rgba(212,175,55,0.35);">
        ğŸ“© WyÅ›lij mi SMS (zgoda ğŸ’›)
      </button>

      <button id="nextActBtn" class="btn btnWide" type="button" style="background: rgba(255,255,255,0.06); color: rgba(255,255,255,0.92); border-color: rgba(212,175,55,0.28);">
        Dalej âœ¨
      </button>
    </div>
  </div>

  <!-- AKT 3 -->
  <div id="final3" class="scene in" style="display:none;">
    <h2 class="final3Title">Zanim siÄ™ spotkamyâ€¦ ğŸ’›</h2>

    <div class="final3Box">
      Agataâ€¦<br><br>
      Nie chcÄ™ juÅ¼ wracaÄ‡ do wersji Å›wiata, w ktÃ³rej jesteÅ›my â€œprawieâ€.<br>
      ChcÄ™ tej, w ktÃ³rej jesteÅ›my <strong>naprawdÄ™</strong> â€” spokojnie, pewnie i ciepÅ‚o.<br><br>

      JeÅ›li zgodzisz siÄ™ zostaÄ‡ mojÄ… WalentynkÄ…, to obiecujÄ™ jedno:
      bÄ™dÄ™ robiÅ‚ wszystko, Å¼ebyÅ› czuÅ‚a siÄ™ przy mnie bezpiecznie, kochana i waÅ¼na. ğŸ–¤âœ¨<br><br>

      I Å¼e to, co w koÅ„cu zobaczyszâ€¦ bÄ™dzie warte czekania.
      <div class="signature">
        â€” TwÃ³j Seba ğŸ’›
      </div>
    </div>

    <!-- âœ… muzyka teÅ¼ w Akcie 3 -->
    <div class="musicCtrl">
      <button id="musicToggle2" class="musicBtn" type="button">
        <span id="musicDot2" class="musicDot"></span>
        <span id="musicLabel2">Muzyka: OFF</span>
      </button>
      <div class="musicMini">MuzykÄ™ moÅ¼esz w kaÅ¼dej chwili wyÅ‚Ä…czyÄ‡.</div>
    </div>

    <div class="btnRow" style="margin-top:14px;">
      <button id="smsBtn2" class="btn btnWide" type="button" style="background: linear-gradient(135deg, rgba(212,175,55,0.92), rgba(242,211,107,0.82)); color:#0b0b0b; font-weight:800;">
        ğŸ“© WyÅ›lij SMS (zgoda) ğŸ’›
      </button>

      <button id="backToPlan" class="btn btnWide" type="button" style="background: rgba(255,255,255,0.06); color: rgba(255,255,255,0.92); border-color: rgba(212,175,55,0.28);">
        WrÃ³Ä‡ â†©ï¸
      </button>
    </div>
  </div>

</div>

<script>
/* =========================
   USTAWIENIA
========================= */
const SMS_NUMBER = "731132304";

/* =========================
   ELEMENTY
========================= */
const yesBtn = document.getElementById("yes");
const noBtn = document.getElementById("no");

const intro = document.getElementById("intro");
const final = document.getElementById("final");
const final3 = document.getElementById("final3");

const heartsLayer = document.getElementById("heartsLayer");
const sparksLayer = document.getElementById("sparksLayer");
const dim = document.getElementById("dim");

const nextActBtn = document.getElementById("nextActBtn");
const backToPlan = document.getElementById("backToPlan");

const smsBtn = document.getElementById("smsBtn");
const smsBtn2 = document.getElementById("smsBtn2");

const loveLayer = document.getElementById("loveTextLayer");
const titleAgata = document.getElementById("titleAgata");

const cowModal = document.getElementById("cowModal");
const cowCloseBtn = document.getElementById("cowCloseBtn");

/* âœ… Muzyka */
const bgm = document.getElementById("bgm");

// Akt 2
const musicToggle = document.getElementById("musicToggle");
const musicDot = document.getElementById("musicDot");
const musicLabel = document.getElementById("musicLabel");
const musicMini = document.getElementById("musicMini");

// Akt 3
const musicToggle2 = document.getElementById("musicToggle2");
const musicDot2 = document.getElementById("musicDot2");
const musicLabel2 = document.getElementById("musicLabel2");

// âœ… Akt 1
const musicToggle0 = document.getElementById("musicToggle0");
const musicDot0 = document.getElementById("musicDot0");
const musicLabel0 = document.getElementById("musicLabel0");
const musicMini0 = document.getElementById("musicMini0");

let musicOn = false;
let fadeRAF = null;

/* =========================
   WYBORY DO SMS
========================= */
function setupChips(groupEl){
  const chips = [...groupEl.querySelectorAll(".chip")];
  chips.forEach(ch => {
    ch.addEventListener("click", () => {
      chips.forEach(c => c.classList.remove("active"));
      ch.classList.add("active");
    });
  });
  return () => {
    const a = groupEl.querySelector(".chip.active");
    return a ? a.dataset.value : "";
  };
}
const getFood = setupChips(document.getElementById("foodPicks"));
const getMovie = setupChips(document.getElementById("moviePicks"));
const getWine = setupChips(document.getElementById("winePicks"));

function buildSMSText(){
  const food = getFood();
  const movie = getMovie();
  const wine = getWine();

  return [
    "TAK ğŸ’›",
    "Zgadzam siÄ™ byÄ‡ TwojÄ… WalentynkÄ….",
    "",
    `Jedzenie decyduje: ${food}`,
    `Film decyduje: ${movie}`,
    `Winko: ${wine}`,
  ].join("\n");
}

function openSMS(){
  const text = buildSMSText();
  const msg = encodeURIComponent(text);
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const link = isIOS
    ? `sms:${SMS_NUMBER}&body=${msg}`
    : `sms:${SMS_NUMBER}?body=${msg}`;
  window.location.href = link;
}

/* =========================
   MUZYKA: ON/OFF + FADE
========================= */
function setMusicUI(on){
  musicOn = on;

  // Akt 1
  if(musicDot0) musicDot0.classList.toggle("on", on);
  if(musicLabel0) musicLabel0.textContent = on ? "Muzyka: ON" : "Muzyka: OFF";

  // Akt 2
  if(musicDot) musicDot.classList.toggle("on", on);
  if(musicLabel) musicLabel.textContent = on ? "Muzyka: ON" : "Muzyka: OFF";

  // Akt 3
  if(musicDot2) musicDot2.classList.toggle("on", on);
  if(musicLabel2) musicLabel2.textContent = on ? "Muzyka: ON" : "Muzyka: OFF";
}

function fadeTo(target, ms=700){
  if(fadeRAF) cancelAnimationFrame(fadeRAF);
  const start = bgm.volume;
  const t0 = performance.now();

  function step(now){
    const p = Math.min(1, (now - t0) / ms);
    bgm.volume = start + (target - start) * p;
    if(p < 1) fadeRAF = requestAnimationFrame(step);
  }
  fadeRAF = requestAnimationFrame(step);
}

async function startMusic(){
  try{
    bgm.volume = 0.02;
    await bgm.play();
    setMusicUI(true);

    if(musicMini0) musicMini0.textContent = "Muzyka graâ€¦ ğŸ’›";
    if(musicMini) musicMini.textContent = "Muzyka graâ€¦ ğŸ’›";

    fadeTo(0.18, 900); // docelowa gÅ‚oÅ›noÅ›Ä‡
  }catch(e){
    setMusicUI(false);
    if(musicMini0) musicMini0.textContent = "Dotknij/kliknij ekran, aby wÅ‚Ä…czyÄ‡ muzykÄ™ ğŸµ";
    if(musicMini) musicMini.textContent = "JeÅ›li nie gra â€” kliknij, Å¼eby wÅ‚Ä…czyÄ‡ (czasem przeglÄ…darka blokuje).";
  }
}

function stopMusic(){
  fadeTo(0.0, 550);
  setTimeout(() => bgm.pause(), 560);
  setMusicUI(false);

  if(musicMini0) musicMini0.textContent = "Dotknij/kliknij ekran, aby wÅ‚Ä…czyÄ‡ muzykÄ™ ğŸµ";
  if(musicMini) musicMini.textContent = "Muzyka zatrzymana.";
}

async function toggleMusic(){
  if(!musicOn) await startMusic();
  else stopMusic();
}

musicToggle0.addEventListener("click", toggleMusic);
musicToggle.addEventListener("click", toggleMusic);
musicToggle2.addEventListener("click", toggleMusic);

bgm.addEventListener("error", () => {
  setMusicUI(false);
  if(musicMini0) musicMini0.textContent = "BÅ‚Ä…d audio. Upewnij siÄ™, Å¼e plik to prawdziwy MP3.";
  if(musicMini) musicMini.textContent = "BÅ‚Ä…d audio. Upewnij siÄ™, Å¼e plik to prawdziwy MP3.";
});

// âœ… Muzyka startuje po pierwszej interakcji gdziekolwiek (Akt 1)
function unlockMusicOnce(){
  if(!musicOn){
    startMusic();
  }
}
document.addEventListener("pointerdown", unlockMusicOnce, { once: true });
document.addEventListener("keydown", unlockMusicOnce, { once: true });

/* =========================
   TAK/NIE â€“ roÅ›nie/pulsuje, NIE ucieka i pÄ™ka
========================= */
let yesScale = 1;
const maxScale = 1.38;
const pulseStartAt = 1.18;
let cracked = false;

function applyYesScale(){
  yesBtn.style.setProperty("--s", yesScale.toFixed(3));
  if(!yesBtn.classList.contains("pulse")){
    yesBtn.style.transform = `scale(${yesScale})`;
  }
}
applyYesScale();

function spawnSparksAt(x, y){
  const count = 9;
  for(let i=0;i<count;i++){
    const s = document.createElement("div");
    s.className = "spark";
    s.style.left = x + "px";
    s.style.top  = y + "px";
    s.style.setProperty("--dx", (Math.random()*80 - 40).toFixed(0) + "px");
    s.style.setProperty("--dy", (-20 - Math.random()*70).toFixed(0) + "px");
    s.style.animationDelay = (Math.random()*70).toFixed(0) + "ms";
    const size = (3 + Math.random()*3).toFixed(0) + "px";
    s.style.width = size;
    s.style.height = size;

    sparksLayer.appendChild(s);
    s.addEventListener("animationend", () => s.remove(), { once:true });
  }
}

function crackNo(){
  if(cracked) return;
  cracked = true;

  const r = noBtn.getBoundingClientRect();
  spawnSparksAt(r.left + r.width/2, r.top + r.height/2);

  noBtn.classList.add("crack");
  noBtn.style.pointerEvents = "none";
  noBtn.addEventListener("animationend", () => {
    noBtn.style.display = "none";
  }, { once:true });
}

function maybeEnablePulse(){
  if(yesScale >= pulseStartAt && !yesBtn.classList.contains("pulse")){
    yesBtn.classList.add("pulse");
    crackNo();
  }
}

function dodgeNo(){
  if(noBtn.style.display !== "none"){
    const x = Math.random() * 220 - 110;
    const y = Math.random() * 120 - 60;
    noBtn.style.transform = `translate(${x}px, ${y}px)`;
  }

  yesScale = Math.min(maxScale, yesScale + 0.055);
  applyYesScale();
  maybeEnablePulse();
}

noBtn.addEventListener("mouseover", dodgeNo);
noBtn.addEventListener("touchstart", (e) => {
  e.preventDefault();
  dodgeNo();
}, {passive:false });

/* serduszka po TAK */
function spawnHeart(){
  const h = document.createElement("div");
  h.className = "goldHeart";
  h.textContent = "ğŸ’›";
  h.style.left = Math.random()*100 + "vw";
  h.style.setProperty("--drift", (Math.random()*80 - 40).toFixed(0) + "px");
  h.style.animationDuration = (5.2 + Math.random()*4.2).toFixed(2) + "s";
  h.style.fontSize = (14 + Math.random()*10).toFixed(0) + "px";
  h.style.opacity = (0.55 + Math.random()*0.35).toFixed(2);
  heartsLayer.appendChild(h);
  h.addEventListener("animationend", ()=>h.remove(), { once:true });
}
function startHearts(){
  heartsLayer.style.display = "block";
  for(let i=0;i<10;i++) setTimeout(spawnHeart, i*120);
  setInterval(spawnHeart, 280);
}

/* =========================
   PRZEJÅšCIA
========================= */
function transition(fromEl, toEl){
  toEl.classList.remove("out");
  toEl.classList.add("in");
  toEl.classList.remove("show");

  dim.classList.add("on");
  setTimeout(() => dim.classList.remove("on"), 260);

  fromEl.classList.add("out");
  fromEl.classList.remove("show");

  setTimeout(() => {
    fromEl.style.display = "none";
    fromEl.classList.remove("out");

    toEl.style.display = "block";
    requestAnimationFrame(() => toEl.classList.add("show"));
  }, 520);
}

/* AKT 1 -> AKT 2 */
function stopLoveTexts(){
  if(window.__loveTimer){
    clearInterval(window.__loveTimer);
    window.__loveTimer = null;
  }
  setTimeout(() => { loveLayer.innerHTML = ""; }, 200);
}

async function goToFinalSmooth(){
  stopLoveTexts();

  dim.classList.add("on");
  setTimeout(() => dim.classList.remove("on"), 260);

  intro.classList.add("out");

  setTimeout(async () => {
    intro.style.display = "none";
    intro.classList.remove("out");

    final.style.display = "block";
    requestAnimationFrame(() => final.classList.add("show"));

    setTimeout(startHearts, 250);

    // âœ… jeÅ›li muzyka jeszcze nie gra, odpal jÄ… (ale nie resetuj)
    if(!musicOn) await startMusic();
  }, 520);
}
yesBtn.addEventListener("click", goToFinalSmooth);

/* AKT 2 -> AKT 3 */
nextActBtn.addEventListener("click", () => transition(final, final3));
/* AKT 3 -> AKT 2 */
backToPlan.addEventListener("click", () => transition(final3, final));

/* SMS */
smsBtn.addEventListener("click", openSMS);
smsBtn2.addEventListener("click", openSMS);

/* =========================
   âœ… LATAJÄ„CE NAPISY W TLE (AKT 1)
========================= */
const LOVE_PHRASES = [
  "kocham ciÄ™ ğŸ’›",
  "mÃ³j skarb âœ¨",
  "z TobÄ… zawsze ğŸ–¤",
  "jesteÅ› moim domem ğŸ¡",
  "tylko ty ğŸŒ™",
  "najpiÄ™kniejsza ğŸ«¶",
  "Agol ğŸ’›",
  "na zawsze i jeszcze dalej âœ¨"
];

function spawnLoveText(){
  if(intro.style.display === "none") return;

  const t = document.createElement("div");
  t.className = "loveText";
  t.textContent = LOVE_PHRASES[Math.floor(Math.random()*LOVE_PHRASES.length)];

  const top = Math.random()*78 + 8;
  t.style.top = top + "vh";
  t.style.setProperty("--dy", (Math.random()*80 - 40).toFixed(0) + "px");

  const dur = 12 + Math.random()*10;
  t.style.animationDuration = dur.toFixed(2) + "s";

  const scale = 0.92 + Math.random()*0.22;
  t.style.transform = `scale(${scale.toFixed(2)})`;

  loveLayer.appendChild(t);
  t.addEventListener("animationend", () => t.remove(), { once:true });
}
for(let i=0;i<4;i++) setTimeout(spawnLoveText, i*650);
window.__loveTimer = setInterval(spawnLoveText, 950);

/* =========================
   âœ… EASTER EGG: 4 klikniÄ™cia w tytuÅ‚ -> krÃ³wka
========================= */
let titleClicks = 0;
let titleClickTimer = null;

function openCow(){
  cowModal.classList.add("on");
  cowModal.setAttribute("aria-hidden", "false");
}
function closeCow(){
  cowModal.classList.remove("on");
  cowModal.setAttribute("aria-hidden", "true");
}

titleAgata.addEventListener("click", () => {
  titleClicks += 1;

  if(titleClickTimer) clearTimeout(titleClickTimer);
  titleClickTimer = setTimeout(() => { titleClicks = 0; }, 900);

  if(titleClicks >= 4){
    titleClicks = 0;
    openCow();
  }
});

cowCloseBtn.addEventListener("click", closeCow);
cowModal.querySelector(".cowBackdrop").addEventListener("click", closeCow);
document.addEventListener("keydown", (e) => {
  if(e.key === "Escape") closeCow();
});

/* start UI muzyki */
setMusicUI(false);
</script>

</body>
</html>
